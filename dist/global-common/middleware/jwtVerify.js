"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.extractUserFromJwt = void 0;
exports.getJWT = getJWT;
exports.hasJWT = hasJWT;
exports.jwtGuard = jwtGuard;
exports.refreshGuard = refreshGuard;
var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken"));
var _logger = require("@global-common/utils/logger");
var _httpError = require("@global-common/error/http-error");
var _env = require("@global-common/constants/env");
var _enum = require("@global-common/constants/enum");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
// import * as jwt from 'jsonwebtoken'

const logger = (0, _logger.getLogger)('jwtVerify.ts');
function getJWT(req) {
  const {
    authorization
  } = req.headers;
  logger.debug('getJWT ', authorization);
  const hasJwt = authorization && authorization.startsWith('Bearer');
  logger.debug('hasJwt ', hasJwt);
  if (!hasJwt) {
    throw new _httpError.Unauthorized(_httpError.NO_JWT, 'No JWT');
  }
  const [, token] = authorization.split(' ');
  logger.debug('token ', token);
  return token;
}
function hasJWT(req) {
  const {
    authorization
  } = req.headers;
  logger.debug('hasJWT ', authorization);
  const hasJwt = authorization && authorization.startsWith('Bearer');
  logger.debug('hasJWT ', hasJwt);
  if (!hasJwt) return false;
  return true;
}
const extractUserFromJwt = async (token, userType) => {
  let jwtPayload;
  try {
    jwtPayload = _jsonwebtoken.default.verify(token, _env.commonEnv.JWT_SECRET_KEY);
    logger.info('jwtPayload: ', jwtPayload);
    validatePayload(jwtPayload, userType, _enum.JwtTokenType.ACCESS);
    logger.info('extractUserFromJwt userId: ', jwtPayload.id);
  } catch (err) {
    if (!(err instanceof _httpError.Unauthorized)) {
      err.status = _httpError.Unauthorized.STATUS;
      err.code = _httpError.INVALID_JWT;
    }
    if (err.name === 'TokenExpiredError') {
      err.code = _httpError.EXPIRED_JWT;
    }
    throw err;
  }
  return {
    id: jwtPayload.id,
    deviceId: jwtPayload.deviceId
  };
};
exports.extractUserFromJwt = extractUserFromJwt;
function validatePayload(jwtPayload, userType, tokenType) {
  if (jwtPayload.type !== userType) throw new _httpError.Unauthorized(_httpError.NOT_AUTHORIZED, 'No matching user type');
  if (jwtPayload.token !== tokenType) throw new _httpError.Unauthorized(_httpError.NOT_AUTHORIZED, 'It is not access token');
}
const extractUserFromJwtWithoutValidate = async ({
  token,
  userType,
  refreshToken
}) => {
  const jwtPayload = _jsonwebtoken.default.decode(token);
  logger.info('decoded jwtPayload: ', jwtPayload);
  validatePayload(jwtPayload, userType, _enum.JwtTokenType.ACCESS);
  try {
    const refreshJwtPayload = _jsonwebtoken.default.verify(refreshToken, _env.commonEnv.JWT_SECRET_KEY);
    validatePayload(refreshJwtPayload, userType, _enum.JwtTokenType.REFRESH);
    logger.info('refresh jwtPayload: ', refreshJwtPayload);
    if (jwtPayload.id !== refreshJwtPayload.id) throw new _httpError.Unauthorized(_httpError.NOT_AUTHORIZED, 'Not Match tokens');
  } catch (err) {
    if (!(err instanceof _httpError.Unauthorized)) {
      err.status = _httpError.Unauthorized.STATUS;
      err.code = _httpError.INVALID_REFRESH_JWT;
    }
    if (err.name === 'TokenExpiredError') {
      err.code = _httpError.EXPIRED_REFRESH_JWT;
    }
    throw err;
  }
  return {
    id: jwtPayload.id,
    deviceId: jwtPayload.deviceId
  };
};
async function jwtGuard(userType, req) {
  const token = getJWT(req);
  const user = await extractUserFromJwt(token, userType);
  return user;
}
async function refreshGuard(userType, req, refreshToken) {
  const token = getJWT(req);
  const user = await extractUserFromJwtWithoutValidate({
    token,
    userType,
    refreshToken
  });
  return user;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJnZXRMb2dnZXIiLCJnZXRKV1QiLCJyZXEiLCJhdXRob3JpemF0aW9uIiwiaGVhZGVycyIsImRlYnVnIiwiaGFzSnd0Iiwic3RhcnRzV2l0aCIsIlVuYXV0aG9yaXplZCIsIk5PX0pXVCIsInRva2VuIiwic3BsaXQiLCJoYXNKV1QiLCJleHRyYWN0VXNlckZyb21Kd3QiLCJ1c2VyVHlwZSIsImp3dFBheWxvYWQiLCJqd3QiLCJ2ZXJpZnkiLCJjb21tb25FbnYiLCJKV1RfU0VDUkVUX0tFWSIsImluZm8iLCJ2YWxpZGF0ZVBheWxvYWQiLCJKd3RUb2tlblR5cGUiLCJBQ0NFU1MiLCJpZCIsImVyciIsInN0YXR1cyIsIlNUQVRVUyIsImNvZGUiLCJJTlZBTElEX0pXVCIsIm5hbWUiLCJFWFBJUkVEX0pXVCIsImRldmljZUlkIiwidG9rZW5UeXBlIiwidHlwZSIsIk5PVF9BVVRIT1JJWkVEIiwiZXh0cmFjdFVzZXJGcm9tSnd0V2l0aG91dFZhbGlkYXRlIiwicmVmcmVzaFRva2VuIiwiZGVjb2RlIiwicmVmcmVzaEp3dFBheWxvYWQiLCJSRUZSRVNIIiwiSU5WQUxJRF9SRUZSRVNIX0pXVCIsIkVYUElSRURfUkVGUkVTSF9KV1QiLCJqd3RHdWFyZCIsInVzZXIiLCJyZWZyZXNoR3VhcmQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZ2xvYmFsLWNvbW1vbi9taWRkbGV3YXJlL2p3dFZlcmlmeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbidcclxuLy8gaW1wb3J0ICogYXMgand0IGZyb20gJ2pzb253ZWJ0b2tlbidcclxuXHJcbmltcG9ydCB7IGdldExvZ2dlciB9IGZyb20gJ0BnbG9iYWwtY29tbW9uL3V0aWxzL2xvZ2dlcidcclxuaW1wb3J0IHsgRVhQSVJFRF9KV1QsIEVYUElSRURfUkVGUkVTSF9KV1QsIElOVkFMSURfSldULCBJTlZBTElEX1JFRlJFU0hfSldULCBOT1RfQVVUSE9SSVpFRCwgTk9fSldULCBOT19VU0VSX0FCT1VUX0pXVCwgVW5hdXRob3JpemVkIH0gZnJvbSAnQGdsb2JhbC1jb21tb24vZXJyb3IvaHR0cC1lcnJvcidcclxuaW1wb3J0IHsgY29tbW9uRW52IH0gZnJvbSAnQGdsb2JhbC1jb21tb24vY29uc3RhbnRzL2VudidcclxuaW1wb3J0IHsgSnd0VG9rZW5UeXBlLCBVc2VyVHlwZSB9IGZyb20gJ0BnbG9iYWwtY29tbW9uL2NvbnN0YW50cy9lbnVtJ1xyXG5cclxuY29uc3QgbG9nZ2VyID0gZ2V0TG9nZ2VyKCdqd3RWZXJpZnkudHMnKVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEpXVCAocmVxKSB7XHJcbiAgY29uc3QgeyBhdXRob3JpemF0aW9uIH0gPSByZXEuaGVhZGVyc1xyXG4gIGxvZ2dlci5kZWJ1ZygnZ2V0SldUICcsIGF1dGhvcml6YXRpb24pXHJcblxyXG4gIGNvbnN0IGhhc0p3dCA9IGF1dGhvcml6YXRpb24gJiYgYXV0aG9yaXphdGlvbi5zdGFydHNXaXRoKCdCZWFyZXInKVxyXG4gIGxvZ2dlci5kZWJ1ZygnaGFzSnd0ICcsIGhhc0p3dClcclxuXHJcbiAgaWYgKCFoYXNKd3QpIHtcclxuICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWQoTk9fSldULCAnTm8gSldUJylcclxuICB9XHJcblxyXG4gIGNvbnN0IFssIHRva2VuXSA9IGF1dGhvcml6YXRpb24uc3BsaXQoJyAnKVxyXG4gIGxvZ2dlci5kZWJ1ZygndG9rZW4gJywgdG9rZW4pXHJcblxyXG4gIHJldHVybiB0b2tlblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFzSldUIChyZXEpIHtcclxuICBjb25zdCB7IGF1dGhvcml6YXRpb24gfSA9IHJlcS5oZWFkZXJzXHJcbiAgbG9nZ2VyLmRlYnVnKCdoYXNKV1QgJywgYXV0aG9yaXphdGlvbilcclxuXHJcbiAgY29uc3QgaGFzSnd0ID0gYXV0aG9yaXphdGlvbiAmJiBhdXRob3JpemF0aW9uLnN0YXJ0c1dpdGgoJ0JlYXJlcicpXHJcbiAgbG9nZ2VyLmRlYnVnKCdoYXNKV1QgJywgaGFzSnd0KVxyXG5cclxuICBpZiAoIWhhc0p3dCkgcmV0dXJuIGZhbHNlXHJcblxyXG4gIHJldHVybiB0cnVlXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBleHRyYWN0VXNlckZyb21Kd3QgPSBhc3luYyAodG9rZW46IHN0cmluZywgdXNlclR5cGUpID0+IHtcclxuICBsZXQgand0UGF5bG9hZFxyXG4gIHRyeSB7XHJcbiAgICBqd3RQYXlsb2FkID0gand0LnZlcmlmeSh0b2tlbiwgY29tbW9uRW52LkpXVF9TRUNSRVRfS0VZKVxyXG4gICAgbG9nZ2VyLmluZm8oJ2p3dFBheWxvYWQ6ICcsIGp3dFBheWxvYWQpXHJcblxyXG4gICAgdmFsaWRhdGVQYXlsb2FkKGp3dFBheWxvYWQsIHVzZXJUeXBlLCBKd3RUb2tlblR5cGUuQUNDRVNTKVxyXG5cclxuICAgIGxvZ2dlci5pbmZvKCdleHRyYWN0VXNlckZyb21Kd3QgdXNlcklkOiAnLCBqd3RQYXlsb2FkLmlkKVxyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgVW5hdXRob3JpemVkKSkge1xyXG4gICAgICBlcnIuc3RhdHVzID0gVW5hdXRob3JpemVkLlNUQVRVU1xyXG4gICAgICBlcnIuY29kZSA9IElOVkFMSURfSldUXHJcbiAgICB9XHJcbiAgICBpZiAoZXJyLm5hbWUgPT09ICdUb2tlbkV4cGlyZWRFcnJvcicpIHtcclxuICAgICAgZXJyLmNvZGUgPSBFWFBJUkVEX0pXVFxyXG4gICAgfVxyXG4gICAgdGhyb3cgZXJyXHJcbiAgfVxyXG5cclxuICByZXR1cm4geyBpZDogand0UGF5bG9hZC5pZCwgZGV2aWNlSWQ6IGp3dFBheWxvYWQuZGV2aWNlSWQgfVxyXG59XHJcblxyXG5mdW5jdGlvbiB2YWxpZGF0ZVBheWxvYWQgKGp3dFBheWxvYWQ6IHsgdHlwZTogc3RyaW5nLCB0b2tlbjogc3RyaW5nLCBpZDogbnVtYmVyIH0sIHVzZXJUeXBlOiBVc2VyVHlwZSwgdG9rZW5UeXBlOiBKd3RUb2tlblR5cGUpIHtcclxuICBpZiAoand0UGF5bG9hZC50eXBlICE9PSB1c2VyVHlwZSkgdGhyb3cgbmV3IFVuYXV0aG9yaXplZChOT1RfQVVUSE9SSVpFRCwgJ05vIG1hdGNoaW5nIHVzZXIgdHlwZScpXHJcbiAgaWYgKGp3dFBheWxvYWQudG9rZW4gIT09IHRva2VuVHlwZSkgdGhyb3cgbmV3IFVuYXV0aG9yaXplZChOT1RfQVVUSE9SSVpFRCwgJ0l0IGlzIG5vdCBhY2Nlc3MgdG9rZW4nKVxyXG59XHJcblxyXG5pbnRlcmZhY2UgdmVyaWZ5SW5mbyB7XHJcbiAgdG9rZW46IHN0cmluZ1xyXG4gIHJlZnJlc2hUb2tlbjogc3RyaW5nXHJcbiAgdXNlclR5cGU6IFVzZXJUeXBlXHJcbn1cclxuY29uc3QgZXh0cmFjdFVzZXJGcm9tSnd0V2l0aG91dFZhbGlkYXRlID0gYXN5bmMgKHsgdG9rZW4sIHVzZXJUeXBlLCByZWZyZXNoVG9rZW4gfTogdmVyaWZ5SW5mbykgPT4ge1xyXG4gIGNvbnN0IGp3dFBheWxvYWQ6IGFueSA9IGp3dC5kZWNvZGUodG9rZW4pXHJcbiAgbG9nZ2VyLmluZm8oJ2RlY29kZWQgand0UGF5bG9hZDogJywgand0UGF5bG9hZClcclxuXHJcbiAgdmFsaWRhdGVQYXlsb2FkKGp3dFBheWxvYWQsIHVzZXJUeXBlLCBKd3RUb2tlblR5cGUuQUNDRVNTKVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVmcmVzaEp3dFBheWxvYWQ6IGFueSA9IGp3dC52ZXJpZnkocmVmcmVzaFRva2VuLCBjb21tb25FbnYuSldUX1NFQ1JFVF9LRVkpXHJcbiAgICB2YWxpZGF0ZVBheWxvYWQocmVmcmVzaEp3dFBheWxvYWQsIHVzZXJUeXBlLCBKd3RUb2tlblR5cGUuUkVGUkVTSClcclxuICAgIGxvZ2dlci5pbmZvKCdyZWZyZXNoIGp3dFBheWxvYWQ6ICcsIHJlZnJlc2hKd3RQYXlsb2FkKVxyXG5cclxuICAgIGlmIChqd3RQYXlsb2FkLmlkICE9PSByZWZyZXNoSnd0UGF5bG9hZC5pZCkgdGhyb3cgbmV3IFVuYXV0aG9yaXplZChOT1RfQVVUSE9SSVpFRCwgJ05vdCBNYXRjaCB0b2tlbnMnKVxyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgVW5hdXRob3JpemVkKSkge1xyXG4gICAgICBlcnIuc3RhdHVzID0gVW5hdXRob3JpemVkLlNUQVRVU1xyXG4gICAgICBlcnIuY29kZSA9IElOVkFMSURfUkVGUkVTSF9KV1RcclxuICAgIH1cclxuICAgIGlmIChlcnIubmFtZSA9PT0gJ1Rva2VuRXhwaXJlZEVycm9yJykge1xyXG4gICAgICBlcnIuY29kZSA9IEVYUElSRURfUkVGUkVTSF9KV1RcclxuICAgIH1cclxuICAgIHRocm93IGVyclxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgaWQ6IGp3dFBheWxvYWQuaWQsIGRldmljZUlkOiBqd3RQYXlsb2FkLmRldmljZUlkIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGp3dEd1YXJkICh1c2VyVHlwZSwgcmVxKSB7XHJcbiAgY29uc3QgdG9rZW4gPSBnZXRKV1QocmVxKVxyXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBleHRyYWN0VXNlckZyb21Kd3QodG9rZW4sIHVzZXJUeXBlKVxyXG4gIHJldHVybiB1c2VyXHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWZyZXNoR3VhcmQgKHVzZXJUeXBlLCByZXEsIHJlZnJlc2hUb2tlbikge1xyXG4gIGNvbnN0IHRva2VuID0gZ2V0SldUKHJlcSlcclxuICBjb25zdCB1c2VyID0gYXdhaXQgZXh0cmFjdFVzZXJGcm9tSnd0V2l0aG91dFZhbGlkYXRlKHsgdG9rZW4sIHVzZXJUeXBlLCByZWZyZXNoVG9rZW4gfSlcclxuXHJcbiAgcmV0dXJuIHVzZXJcclxufVxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQXNFO0FBTHRFOztBQU9BLE1BQU1BLE1BQU0sR0FB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