"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = babyRoutes;
var _express = require("express");
var _joi = _interopRequireDefault(require("joi"));
var _userGuard = require("@diary-server/routes/middleware/userGuard");
var _asyncHandler = _interopRequireDefault(require("@global-common/server/routes/helper/asyncHandler"));
var _babyController = require("@diary-server/controller/baby-controller");
var _validator = require("@global-common/utils/validator");
var _utils = require("@global-common/server/routes/helper/utils");
var _localUpload = require("@global-common/middleware/local-upload");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function babyRoutes(router = (0, _express.Router)()) {
  // 아이 목록
  router.get('/diary/baby', _userGuard.diaryGuard, (0, _asyncHandler.default)(getBabyList));
  // 아이 등록
  router.post('/diary/baby', _userGuard.diaryGuard, (0, _asyncHandler.default)(postBaby));
  // 아이 수정
  router.put('/diary/baby/:id', _userGuard.diaryGuard, (0, _asyncHandler.default)(putBaby));
  // 아이 삭제
  router.delete('/diary/baby/:id', _userGuard.diaryGuard, (0, _asyncHandler.default)(deleteBaby));
  // 아이 사진 등록
  router.patch('/diary/baby/:id/face', _userGuard.diaryGuard, _localUpload.localUpload.single('file'), (0, _asyncHandler.default)(patchBabyFace));
  async function getBabyList(req, res) {
    const result = await (0, _babyController.loadBabyList)(req.user.id);
    res.json(result);
  }
  async function postBaby(req, res) {
    const params = (0, _validator.validateInputData)(req.body, {
      name: _joi.default.string().required(),
      birthDate: _joi.default.date(),
      gender: _joi.default.string(),
      expectDate: _joi.default.date(),
      pregnantDate: _joi.default.date()
    });
    await (0, _babyController.saveBaby)(params, req.user.id);
    (0, _utils.sendOk)(res);
  }
  async function putBaby(req, res) {
    const params = (0, _validator.validateInputData)(req.body, {
      name: _joi.default.string().required(),
      birthDate: _joi.default.date(),
      gender: _joi.default.string(),
      face: _joi.default.string(),
      expectDate: _joi.default.date(),
      pregnantDate: _joi.default.date()
    });
    await (0, _babyController.modifyBaby)(params, req.params.id);
    (0, _utils.sendOk)(res);
  }
  async function deleteBaby(req, res) {
    const {
      id
    } = req.params;
    await (0, _babyController.removeBaby)(id);
    (0, _utils.sendOk)(res);
  }
  async function patchBabyFace(req, res) {
    await (0, _babyController.saveBabyFace)(req.user.id, req.params.id, req.file);
    (0, _utils.sendOk)(res);
  }
  return router;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJiYWJ5Um91dGVzIiwicm91dGVyIiwiUm91dGVyIiwiZ2V0IiwiZGlhcnlHdWFyZCIsImFzeW5jSGFuZGxlciIsImdldEJhYnlMaXN0IiwicG9zdCIsInBvc3RCYWJ5IiwicHV0IiwicHV0QmFieSIsImRlbGV0ZSIsImRlbGV0ZUJhYnkiLCJwYXRjaCIsImxvY2FsVXBsb2FkIiwic2luZ2xlIiwicGF0Y2hCYWJ5RmFjZSIsInJlcSIsInJlcyIsInJlc3VsdCIsImxvYWRCYWJ5TGlzdCIsInVzZXIiLCJpZCIsImpzb24iLCJwYXJhbXMiLCJ2YWxpZGF0ZUlucHV0RGF0YSIsImJvZHkiLCJuYW1lIiwiSm9pIiwic3RyaW5nIiwicmVxdWlyZWQiLCJiaXJ0aERhdGUiLCJkYXRlIiwiZ2VuZGVyIiwiZXhwZWN0RGF0ZSIsInByZWduYW50RGF0ZSIsInNhdmVCYWJ5Iiwic2VuZE9rIiwiZmFjZSIsIm1vZGlmeUJhYnkiLCJyZW1vdmVCYWJ5Iiwic2F2ZUJhYnlGYWNlIiwiZmlsZSJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kaWFyeS1zZXJ2ZXIvcm91dGVzL2RlZmF1bHQtbG9hZC9iYWJ5LXJvdXRlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJ1xyXG5pbXBvcnQgSm9pIGZyb20gJ2pvaSdcclxuXHJcbmltcG9ydCB7IGRpYXJ5R3VhcmQgfSBmcm9tICdAZGlhcnktc2VydmVyL3JvdXRlcy9taWRkbGV3YXJlL3VzZXJHdWFyZCdcclxuaW1wb3J0IGFzeW5jSGFuZGxlciBmcm9tICdAZ2xvYmFsLWNvbW1vbi9zZXJ2ZXIvcm91dGVzL2hlbHBlci9hc3luY0hhbmRsZXInXHJcbmltcG9ydCB7IGxvYWRCYWJ5TGlzdCwgbW9kaWZ5QmFieSwgcmVtb3ZlQmFieSwgc2F2ZUJhYnksIHNhdmVCYWJ5RmFjZSB9IGZyb20gJ0BkaWFyeS1zZXJ2ZXIvY29udHJvbGxlci9iYWJ5LWNvbnRyb2xsZXInXHJcbmltcG9ydCB7IHZhbGlkYXRlSW5wdXREYXRhIH0gZnJvbSAnQGdsb2JhbC1jb21tb24vdXRpbHMvdmFsaWRhdG9yJ1xyXG5pbXBvcnQgeyBzZW5kT2sgfSBmcm9tICdAZ2xvYmFsLWNvbW1vbi9zZXJ2ZXIvcm91dGVzL2hlbHBlci91dGlscydcclxuaW1wb3J0IHsgbG9jYWxVcGxvYWQgfSBmcm9tICdAZ2xvYmFsLWNvbW1vbi9taWRkbGV3YXJlL2xvY2FsLXVwbG9hZCdcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGJhYnlSb3V0ZXMgKHJvdXRlciA9IFJvdXRlcigpKSB7XHJcbiAgLy8g7JWE7J20IOuqqeuhnVxyXG4gIHJvdXRlci5nZXQoJy9kaWFyeS9iYWJ5JywgZGlhcnlHdWFyZCwgYXN5bmNIYW5kbGVyKGdldEJhYnlMaXN0KSlcclxuICAvLyDslYTsnbQg65Ox66GdXHJcbiAgcm91dGVyLnBvc3QoJy9kaWFyeS9iYWJ5JywgZGlhcnlHdWFyZCwgYXN5bmNIYW5kbGVyKHBvc3RCYWJ5KSlcclxuICAvLyDslYTsnbQg7IiY7KCVXHJcbiAgcm91dGVyLnB1dCgnL2RpYXJ5L2JhYnkvOmlkJywgZGlhcnlHdWFyZCwgYXN5bmNIYW5kbGVyKHB1dEJhYnkpKVxyXG4gIC8vIOyVhOydtCDsgq3soJxcclxuICByb3V0ZXIuZGVsZXRlKCcvZGlhcnkvYmFieS86aWQnLCBkaWFyeUd1YXJkLCBhc3luY0hhbmRsZXIoZGVsZXRlQmFieSkpXHJcbiAgLy8g7JWE7J20IOyCrOynhCDrk7HroZ1cclxuICByb3V0ZXIucGF0Y2goJy9kaWFyeS9iYWJ5LzppZC9mYWNlJywgZGlhcnlHdWFyZCwgbG9jYWxVcGxvYWQuc2luZ2xlKCdmaWxlJyksIGFzeW5jSGFuZGxlcihwYXRjaEJhYnlGYWNlKSlcclxuXHJcbiAgYXN5bmMgZnVuY3Rpb24gZ2V0QmFieUxpc3QgKHJlcSwgcmVzKSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsb2FkQmFieUxpc3QocmVxLnVzZXIuaWQpXHJcblxyXG4gICAgcmVzLmpzb24ocmVzdWx0KVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZnVuY3Rpb24gcG9zdEJhYnkgKHJlcSwgcmVzKSB7XHJcbiAgICBjb25zdCBwYXJhbXMgPSB2YWxpZGF0ZUlucHV0RGF0YShyZXEuYm9keSwge1xyXG4gICAgICBuYW1lOiBKb2kuc3RyaW5nKCkucmVxdWlyZWQoKSxcclxuICAgICAgYmlydGhEYXRlOiBKb2kuZGF0ZSgpLFxyXG4gICAgICBnZW5kZXI6IEpvaS5zdHJpbmcoKSxcclxuICAgICAgZXhwZWN0RGF0ZTogSm9pLmRhdGUoKSxcclxuICAgICAgcHJlZ25hbnREYXRlOiBKb2kuZGF0ZSgpLFxyXG4gICAgfSlcclxuXHJcbiAgICBhd2FpdCBzYXZlQmFieShwYXJhbXMsIHJlcS51c2VyLmlkKVxyXG5cclxuICAgIHNlbmRPayhyZXMpXHJcbiAgfVxyXG5cclxuICBhc3luYyBmdW5jdGlvbiBwdXRCYWJ5IChyZXEsIHJlcykge1xyXG4gICAgY29uc3QgcGFyYW1zID0gdmFsaWRhdGVJbnB1dERhdGEocmVxLmJvZHksIHtcclxuICAgICAgbmFtZTogSm9pLnN0cmluZygpLnJlcXVpcmVkKCksXHJcbiAgICAgIGJpcnRoRGF0ZTogSm9pLmRhdGUoKSxcclxuICAgICAgZ2VuZGVyOiBKb2kuc3RyaW5nKCksXHJcbiAgICAgIGZhY2U6IEpvaS5zdHJpbmcoKSxcclxuICAgICAgZXhwZWN0RGF0ZTogSm9pLmRhdGUoKSxcclxuICAgICAgcHJlZ25hbnREYXRlOiBKb2kuZGF0ZSgpLFxyXG4gICAgfSlcclxuXHJcbiAgICBhd2FpdCBtb2RpZnlCYWJ5KHBhcmFtcywgcmVxLnBhcmFtcy5pZClcclxuXHJcbiAgICBzZW5kT2socmVzKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZnVuY3Rpb24gZGVsZXRlQmFieSAocmVxLCByZXMpIHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXNcclxuXHJcbiAgICBhd2FpdCByZW1vdmVCYWJ5KGlkKVxyXG5cclxuICAgIHNlbmRPayhyZXMpXHJcbiAgfVxyXG5cclxuICBhc3luYyBmdW5jdGlvbiBwYXRjaEJhYnlGYWNlIChyZXEsIHJlcykge1xyXG4gICAgYXdhaXQgc2F2ZUJhYnlGYWNlKHJlcS51c2VyLmlkLCByZXEucGFyYW1zLmlkLCByZXEuZmlsZSlcclxuXHJcbiAgICBzZW5kT2socmVzKVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJvdXRlclxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFvRTtBQUVyRCxTQUFTQSxVQUFVLENBQUVDLE1BQU0sR0FBRyxJQUFBQyxlQUFNLEdBQUUsRUFBRTtFQUNyRDtFQUNBRCxNQUFNLENBQUNFLEdBQUcsQ0FBQyxhQUFhLEVBQUVDLHFCQUFVLEVBQUUsSUFBQUMscUJBQVksRUFBQ0MsV0FBVyxDQUFDLENBQUM7RUFDaEU7RUFDQUwsTUFBTSxDQUFDTSxJQUFJLENBQUMsYUFBYSxFQUFFSCxxQkFBVSxFQUFFLElBQUFDLHFCQUFZLEVBQUNHLFFBQVEsQ0FBQyxDQUFDO0VBQzlEO0VBQ0FQLE1BQU0sQ0FBQ1EsR0FBRyxDQUFDLGlCQUFpQixFQUFFTCxxQkFBVSxFQUFFLElBQUFDLHFCQUFZLEVBQUNLLE9BQU8sQ0FBQyxDQUFDO0VBQ2hFO0VBQ0FULE1BQU0sQ0FBQ1UsTUFBTSxDQUFDLGlCQUFpQixFQUFFUCxxQkFBVSxFQUFFLElBQUFDLHFCQUFZLEVBQUNPLFVBQVUsQ0FBQyxDQUFDO0VBQ3RFO0VBQ0FYLE1BQU0sQ0FBQ1ksS0FBSyxDQUFDLHNCQUFzQixFQUFFVCxxQkFBVSxFQUFFVSx3QkFBVyxDQUFDQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBQVYscUJBQVksRUFBQ1csYUFBYSxDQUFDLENBQUM7RUFFekcsZUFBZVYsV0FBVyxDQUFFVyxHQUFHLEVBQUVDLEdBQUcsRUFBRTtJQUNwQyxNQUFNQyxNQUFNLEdBQUcsTUFBTSxJQUFBQyw0QkFBWSxFQUFDSCxHQUFHLENBQUNJLElBQUksQ0FBQ0MsRUFBRSxDQUFDO0lBRTlDSixHQUFHLENBQUNLLElBQUksQ0FBQ0osTUFBTSxDQUFDO0VBQ2xCO0VBRUEsZUFBZVgsUUFBUSxDQUFFUyxHQUFHLEVBQUVDLEdBQUcsRUFBRTtJQUNqQyxNQUFNTSxNQUFNLEdBQUcsSUFBQUMsNEJBQWlCLEVBQUNSLEdBQUcsQ0FBQ1MsSUFBSSxFQUFFO01BQ3pDQyxJQUFJLEVBQUVDLFlBQUcsQ0FBQ0MsTUFBTSxFQUFFLENBQUNDLFFBQVEsRUFBRTtNQUM3QkMsU0FBUyxFQUFFSCxZQUFHLENBQUNJLElBQUksRUFBRTtNQUNyQkMsTUFBTSxFQUFFTCxZQUFHLENBQUNDLE1BQU0sRUFBRTtNQUNwQkssVUFBVSxFQUFFTixZQUFHLENBQUNJLElBQUksRUFBRTtNQUN0QkcsWUFBWSxFQUFFUCxZQUFHLENBQUNJLElBQUk7SUFDeEIsQ0FBQyxDQUFDO0lBRUYsTUFBTSxJQUFBSSx3QkFBUSxFQUFDWixNQUFNLEVBQUVQLEdBQUcsQ0FBQ0ksSUFBSSxDQUFDQyxFQUFFLENBQUM7SUFFbkMsSUFBQWUsYUFBTSxFQUFDbkIsR0FBRyxDQUFDO0VBQ2I7RUFFQSxlQUFlUixPQUFPLENBQUVPLEdBQUcsRUFBRUMsR0FBRyxFQUFFO0lBQ2hDLE1BQU1NLE1BQU0sR0FBRyxJQUFBQyw0QkFBaUIsRUFBQ1IsR0FBRyxDQUFDUyxJQUFJLEVBQUU7TUFDekNDLElBQUksRUFBRUMsWUFBRyxDQUFDQyxNQUFNLEVBQUUsQ0FBQ0MsUUFBUSxFQUFFO01BQzdCQyxTQUFTLEVBQUVILFlBQUcsQ0FBQ0ksSUFBSSxFQUFFO01BQ3JCQyxNQUFNLEVBQUVMLFlBQUcsQ0FBQ0MsTUFBTSxFQUFFO01BQ3BCUyxJQUFJLEVBQUVWLFlBQUcsQ0FBQ0MsTUFBTSxFQUFFO01BQ2xCSyxVQUFVLEVBQUVOLFlBQUcsQ0FBQ0ksSUFBSSxFQUFFO01BQ3RCRyxZQUFZLEVBQUVQLFlBQUcsQ0FBQ0ksSUFBSTtJQUN4QixDQUFDLENBQUM7SUFFRixNQUFNLElBQUFPLDBCQUFVLEVBQUNmLE1BQU0sRUFBRVAsR0FBRyxDQUFDTyxNQUFNLENBQUNGLEVBQUUsQ0FBQztJQUV2QyxJQUFBZSxhQUFNLEVBQUNuQixHQUFHLENBQUM7RUFDYjtFQUVBLGVBQWVOLFVBQVUsQ0FBRUssR0FBRyxFQUFFQyxHQUFHLEVBQUU7SUFDbkMsTUFBTTtNQUFFSTtJQUFHLENBQUMsR0FBR0wsR0FBRyxDQUFDTyxNQUFNO0lBRXpCLE1BQU0sSUFBQWdCLDBCQUFVLEVBQUNsQixFQUFFLENBQUM7SUFFcEIsSUFBQWUsYUFBTSxFQUFDbkIsR0FBRyxDQUFDO0VBQ2I7RUFFQSxlQUFlRixhQUFhLENBQUVDLEdBQUcsRUFBRUMsR0FBRyxFQUFFO0lBQ3RDLE1BQU0sSUFBQXVCLDRCQUFZLEVBQUN4QixHQUFHLENBQUNJLElBQUksQ0FBQ0MsRUFBRSxFQUFFTCxHQUFHLENBQUNPLE1BQU0sQ0FBQ0YsRUFBRSxFQUFFTCxHQUFHLENBQUN5QixJQUFJLENBQUM7SUFFeEQsSUFBQUwsYUFBTSxFQUFDbkIsR0FBRyxDQUFDO0VBQ2I7RUFFQSxPQUFPakIsTUFBTTtBQUNmIn0=