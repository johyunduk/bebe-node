"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = babyRoutes;
var _express = require("express");
var _joi = _interopRequireDefault(require("joi"));
var _userGuard = require("@diary-server/routes/middleware/userGuard");
var _asyncHandler = _interopRequireDefault(require("@global-common/server/routes/helper/asyncHandler"));
var _babyController = require("@diary-server/controller/baby-controller");
var _validator = require("@global-common/utils/validator");
var _utils = require("@global-common/server/routes/helper/utils");
var _localUpload = require("@global-common/middleware/local-upload");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function babyRoutes(router = (0, _express.Router)()) {
  // 아이 목록
  router.get('/diary/baby', _userGuard.diaryGuard, (0, _asyncHandler.default)(getBabyList));
  // 아이 등록
  router.post('/diary/baby', _userGuard.diaryGuard, (0, _asyncHandler.default)(postBaby));
  // 아이 수정
  router.put('/diary/baby/:id', _userGuard.diaryGuard, (0, _asyncHandler.default)(putBaby));
  // 아이 삭제
  router.delete('/diary/baby/:id', _userGuard.diaryGuard, (0, _asyncHandler.default)(deleteBaby));
  // 아이 사진 등록
  router.patch('/diary/baby/:id/face', _userGuard.diaryGuard, _localUpload.localUpload.single('file'), (0, _asyncHandler.default)(patchBabyFace));
  async function getBabyList(req, res) {
    const result = await (0, _babyController.loadBabyList)(req.user.id);
    res.json(result);
  }
  async function postBaby(req, res) {
    const params = (0, _validator.validateInputData)(req.body, {
      name: _joi.default.string().required(),
      birthDate: _joi.default.date(),
      gender: _joi.default.string(),
      expectDate: _joi.default.date(),
      pregnantDate: _joi.default.date()
    });
    await (0, _babyController.saveBaby)(params, req.user.id);
    (0, _utils.sendOk)(res);
  }
  async function putBaby(req, res) {
    const params = (0, _validator.validateInputData)(req.body, {
      name: _joi.default.string().required(),
      birthDate: _joi.default.date(),
      gender: _joi.default.string(),
      expectDate: _joi.default.date(),
      pregnantDate: _joi.default.date()
    });
    await (0, _babyController.modifyBaby)(params, req.params.id);
    (0, _utils.sendOk)(res);
  }
  async function deleteBaby(req, res) {
    const {
      id
    } = req.params;
    await (0, _babyController.removeBaby)(id);
    (0, _utils.sendOk)(res);
  }
  async function patchBabyFace(req, res) {
    await (0, _babyController.saveBabyFace)(req.user.id, req.params.id, req.file);
    (0, _utils.sendOk)(res);
  }
  return router;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJiYWJ5Um91dGVzIiwicm91dGVyIiwiUm91dGVyIiwiZ2V0IiwiZGlhcnlHdWFyZCIsImFzeW5jSGFuZGxlciIsImdldEJhYnlMaXN0IiwicG9zdCIsInBvc3RCYWJ5IiwicHV0IiwicHV0QmFieSIsImRlbGV0ZSIsImRlbGV0ZUJhYnkiLCJwYXRjaCIsImxvY2FsVXBsb2FkIiwic2luZ2xlIiwicGF0Y2hCYWJ5RmFjZSIsInJlcSIsInJlcyIsInJlc3VsdCIsImxvYWRCYWJ5TGlzdCIsInVzZXIiLCJpZCIsImpzb24iLCJwYXJhbXMiLCJ2YWxpZGF0ZUlucHV0RGF0YSIsImJvZHkiLCJuYW1lIiwiSm9pIiwic3RyaW5nIiwicmVxdWlyZWQiLCJiaXJ0aERhdGUiLCJkYXRlIiwiZ2VuZGVyIiwiZXhwZWN0RGF0ZSIsInByZWduYW50RGF0ZSIsInNhdmVCYWJ5Iiwic2VuZE9rIiwibW9kaWZ5QmFieSIsInJlbW92ZUJhYnkiLCJzYXZlQmFieUZhY2UiLCJmaWxlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2RpYXJ5LXNlcnZlci9yb3V0ZXMvZGVmYXVsdC1sb2FkL2JhYnktcm91dGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnXHJcbmltcG9ydCBKb2kgZnJvbSAnam9pJ1xyXG5cclxuaW1wb3J0IHsgZGlhcnlHdWFyZCB9IGZyb20gJ0BkaWFyeS1zZXJ2ZXIvcm91dGVzL21pZGRsZXdhcmUvdXNlckd1YXJkJ1xyXG5pbXBvcnQgYXN5bmNIYW5kbGVyIGZyb20gJ0BnbG9iYWwtY29tbW9uL3NlcnZlci9yb3V0ZXMvaGVscGVyL2FzeW5jSGFuZGxlcidcclxuaW1wb3J0IHsgbG9hZEJhYnlMaXN0LCBtb2RpZnlCYWJ5LCByZW1vdmVCYWJ5LCBzYXZlQmFieSwgc2F2ZUJhYnlGYWNlIH0gZnJvbSAnQGRpYXJ5LXNlcnZlci9jb250cm9sbGVyL2JhYnktY29udHJvbGxlcidcclxuaW1wb3J0IHsgdmFsaWRhdGVJbnB1dERhdGEgfSBmcm9tICdAZ2xvYmFsLWNvbW1vbi91dGlscy92YWxpZGF0b3InXHJcbmltcG9ydCB7IHNlbmRPayB9IGZyb20gJ0BnbG9iYWwtY29tbW9uL3NlcnZlci9yb3V0ZXMvaGVscGVyL3V0aWxzJ1xyXG5pbXBvcnQgeyBsb2NhbFVwbG9hZCB9IGZyb20gJ0BnbG9iYWwtY29tbW9uL21pZGRsZXdhcmUvbG9jYWwtdXBsb2FkJ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYmFieVJvdXRlcyAocm91dGVyID0gUm91dGVyKCkpIHtcclxuICAvLyDslYTsnbQg66qp66GdXHJcbiAgcm91dGVyLmdldCgnL2RpYXJ5L2JhYnknLCBkaWFyeUd1YXJkLCBhc3luY0hhbmRsZXIoZ2V0QmFieUxpc3QpKVxyXG4gIC8vIOyVhOydtCDrk7HroZ1cclxuICByb3V0ZXIucG9zdCgnL2RpYXJ5L2JhYnknLCBkaWFyeUd1YXJkLCBhc3luY0hhbmRsZXIocG9zdEJhYnkpKVxyXG4gIC8vIOyVhOydtCDsiJjsoJVcclxuICByb3V0ZXIucHV0KCcvZGlhcnkvYmFieS86aWQnLCBkaWFyeUd1YXJkLCBhc3luY0hhbmRsZXIocHV0QmFieSkpXHJcbiAgLy8g7JWE7J20IOyCreygnFxyXG4gIHJvdXRlci5kZWxldGUoJy9kaWFyeS9iYWJ5LzppZCcsIGRpYXJ5R3VhcmQsIGFzeW5jSGFuZGxlcihkZWxldGVCYWJ5KSlcclxuICAvLyDslYTsnbQg7IKs7KeEIOuTseuhnVxyXG4gIHJvdXRlci5wYXRjaCgnL2RpYXJ5L2JhYnkvOmlkL2ZhY2UnLCBkaWFyeUd1YXJkLCBsb2NhbFVwbG9hZC5zaW5nbGUoJ2ZpbGUnKSwgYXN5bmNIYW5kbGVyKHBhdGNoQmFieUZhY2UpKVxyXG5cclxuICBhc3luYyBmdW5jdGlvbiBnZXRCYWJ5TGlzdCAocmVxLCByZXMpIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxvYWRCYWJ5TGlzdChyZXEudXNlci5pZClcclxuXHJcbiAgICByZXMuanNvbihyZXN1bHQpXHJcbiAgfVxyXG5cclxuICBhc3luYyBmdW5jdGlvbiBwb3N0QmFieSAocmVxLCByZXMpIHtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHZhbGlkYXRlSW5wdXREYXRhKHJlcS5ib2R5LCB7XHJcbiAgICAgIG5hbWU6IEpvaS5zdHJpbmcoKS5yZXF1aXJlZCgpLFxyXG4gICAgICBiaXJ0aERhdGU6IEpvaS5kYXRlKCksXHJcbiAgICAgIGdlbmRlcjogSm9pLnN0cmluZygpLFxyXG4gICAgICBleHBlY3REYXRlOiBKb2kuZGF0ZSgpLFxyXG4gICAgICBwcmVnbmFudERhdGU6IEpvaS5kYXRlKCksXHJcbiAgICB9KVxyXG5cclxuICAgIGF3YWl0IHNhdmVCYWJ5KHBhcmFtcywgcmVxLnVzZXIuaWQpXHJcblxyXG4gICAgc2VuZE9rKHJlcylcclxuICB9XHJcblxyXG4gIGFzeW5jIGZ1bmN0aW9uIHB1dEJhYnkgKHJlcSwgcmVzKSB7XHJcbiAgICBjb25zdCBwYXJhbXMgPSB2YWxpZGF0ZUlucHV0RGF0YShyZXEuYm9keSwge1xyXG4gICAgICBuYW1lOiBKb2kuc3RyaW5nKCkucmVxdWlyZWQoKSxcclxuICAgICAgYmlydGhEYXRlOiBKb2kuZGF0ZSgpLFxyXG4gICAgICBnZW5kZXI6IEpvaS5zdHJpbmcoKSxcclxuICAgICAgZXhwZWN0RGF0ZTogSm9pLmRhdGUoKSxcclxuICAgICAgcHJlZ25hbnREYXRlOiBKb2kuZGF0ZSgpLFxyXG4gICAgfSlcclxuXHJcbiAgICBhd2FpdCBtb2RpZnlCYWJ5KHBhcmFtcywgcmVxLnBhcmFtcy5pZClcclxuXHJcbiAgICBzZW5kT2socmVzKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZnVuY3Rpb24gZGVsZXRlQmFieSAocmVxLCByZXMpIHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXNcclxuXHJcbiAgICBhd2FpdCByZW1vdmVCYWJ5KGlkKVxyXG5cclxuICAgIHNlbmRPayhyZXMpXHJcbiAgfVxyXG5cclxuICBhc3luYyBmdW5jdGlvbiBwYXRjaEJhYnlGYWNlIChyZXEsIHJlcykge1xyXG4gICAgYXdhaXQgc2F2ZUJhYnlGYWNlKHJlcS51c2VyLmlkLCByZXEucGFyYW1zLmlkLCByZXEuZmlsZSlcclxuXHJcbiAgICBzZW5kT2socmVzKVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJvdXRlclxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFvRTtBQUVyRCxTQUFTQSxVQUFVLENBQUVDLE1BQU0sR0FBRyxJQUFBQyxlQUFNLEdBQUUsRUFBRTtFQUNyRDtFQUNBRCxNQUFNLENBQUNFLEdBQUcsQ0FBQyxhQUFhLEVBQUVDLHFCQUFVLEVBQUUsSUFBQUMscUJBQVksRUFBQ0MsV0FBVyxDQUFDLENBQUM7RUFDaEU7RUFDQUwsTUFBTSxDQUFDTSxJQUFJLENBQUMsYUFBYSxFQUFFSCxxQkFBVSxFQUFFLElBQUFDLHFCQUFZLEVBQUNHLFFBQVEsQ0FBQyxDQUFDO0VBQzlEO0VBQ0FQLE1BQU0sQ0FBQ1EsR0FBRyxDQUFDLGlCQUFpQixFQUFFTCxxQkFBVSxFQUFFLElBQUFDLHFCQUFZLEVBQUNLLE9BQU8sQ0FBQyxDQUFDO0VBQ2hFO0VBQ0FULE1BQU0sQ0FBQ1UsTUFBTSxDQUFDLGlCQUFpQixFQUFFUCxxQkFBVSxFQUFFLElBQUFDLHFCQUFZLEVBQUNPLFVBQVUsQ0FBQyxDQUFDO0VBQ3RFO0VBQ0FYLE1BQU0sQ0FBQ1ksS0FBSyxDQUFDLHNCQUFzQixFQUFFVCxxQkFBVSxFQUFFVSx3QkFBVyxDQUFDQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBQVYscUJBQVksRUFBQ1csYUFBYSxDQUFDLENBQUM7RUFFekcsZUFBZVYsV0FBVyxDQUFFVyxHQUFHLEVBQUVDLEdBQUcsRUFBRTtJQUNwQyxNQUFNQyxNQUFNLEdBQUcsTUFBTSxJQUFBQyw0QkFBWSxFQUFDSCxHQUFHLENBQUNJLElBQUksQ0FBQ0MsRUFBRSxDQUFDO0lBRTlDSixHQUFHLENBQUNLLElBQUksQ0FBQ0osTUFBTSxDQUFDO0VBQ2xCO0VBRUEsZUFBZVgsUUFBUSxDQUFFUyxHQUFHLEVBQUVDLEdBQUcsRUFBRTtJQUNqQyxNQUFNTSxNQUFNLEdBQUcsSUFBQUMsNEJBQWlCLEVBQUNSLEdBQUcsQ0FBQ1MsSUFBSSxFQUFFO01BQ3pDQyxJQUFJLEVBQUVDLFlBQUcsQ0FBQ0MsTUFBTSxFQUFFLENBQUNDLFFBQVEsRUFBRTtNQUM3QkMsU0FBUyxFQUFFSCxZQUFHLENBQUNJLElBQUksRUFBRTtNQUNyQkMsTUFBTSxFQUFFTCxZQUFHLENBQUNDLE1BQU0sRUFBRTtNQUNwQkssVUFBVSxFQUFFTixZQUFHLENBQUNJLElBQUksRUFBRTtNQUN0QkcsWUFBWSxFQUFFUCxZQUFHLENBQUNJLElBQUk7SUFDeEIsQ0FBQyxDQUFDO0lBRUYsTUFBTSxJQUFBSSx3QkFBUSxFQUFDWixNQUFNLEVBQUVQLEdBQUcsQ0FBQ0ksSUFBSSxDQUFDQyxFQUFFLENBQUM7SUFFbkMsSUFBQWUsYUFBTSxFQUFDbkIsR0FBRyxDQUFDO0VBQ2I7RUFFQSxlQUFlUixPQUFPLENBQUVPLEdBQUcsRUFBRUMsR0FBRyxFQUFFO0lBQ2hDLE1BQU1NLE1BQU0sR0FBRyxJQUFBQyw0QkFBaUIsRUFBQ1IsR0FBRyxDQUFDUyxJQUFJLEVBQUU7TUFDekNDLElBQUksRUFBRUMsWUFBRyxDQUFDQyxNQUFNLEVBQUUsQ0FBQ0MsUUFBUSxFQUFFO01BQzdCQyxTQUFTLEVBQUVILFlBQUcsQ0FBQ0ksSUFBSSxFQUFFO01BQ3JCQyxNQUFNLEVBQUVMLFlBQUcsQ0FBQ0MsTUFBTSxFQUFFO01BQ3BCSyxVQUFVLEVBQUVOLFlBQUcsQ0FBQ0ksSUFBSSxFQUFFO01BQ3RCRyxZQUFZLEVBQUVQLFlBQUcsQ0FBQ0ksSUFBSTtJQUN4QixDQUFDLENBQUM7SUFFRixNQUFNLElBQUFNLDBCQUFVLEVBQUNkLE1BQU0sRUFBRVAsR0FBRyxDQUFDTyxNQUFNLENBQUNGLEVBQUUsQ0FBQztJQUV2QyxJQUFBZSxhQUFNLEVBQUNuQixHQUFHLENBQUM7RUFDYjtFQUVBLGVBQWVOLFVBQVUsQ0FBRUssR0FBRyxFQUFFQyxHQUFHLEVBQUU7SUFDbkMsTUFBTTtNQUFFSTtJQUFHLENBQUMsR0FBR0wsR0FBRyxDQUFDTyxNQUFNO0lBRXpCLE1BQU0sSUFBQWUsMEJBQVUsRUFBQ2pCLEVBQUUsQ0FBQztJQUVwQixJQUFBZSxhQUFNLEVBQUNuQixHQUFHLENBQUM7RUFDYjtFQUVBLGVBQWVGLGFBQWEsQ0FBRUMsR0FBRyxFQUFFQyxHQUFHLEVBQUU7SUFDdEMsTUFBTSxJQUFBc0IsNEJBQVksRUFBQ3ZCLEdBQUcsQ0FBQ0ksSUFBSSxDQUFDQyxFQUFFLEVBQUVMLEdBQUcsQ0FBQ08sTUFBTSxDQUFDRixFQUFFLEVBQUVMLEdBQUcsQ0FBQ3dCLElBQUksQ0FBQztJQUV4RCxJQUFBSixhQUFNLEVBQUNuQixHQUFHLENBQUM7RUFDYjtFQUVBLE9BQU9qQixNQUFNO0FBQ2YifQ==