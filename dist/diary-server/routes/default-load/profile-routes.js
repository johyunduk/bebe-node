"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = profileRoutes;
var _express = require("express");
var _joi = _interopRequireDefault(require("joi"));
var _lodash = _interopRequireDefault(require("lodash"));
var _userGuard = require("@diary-server/routes/middleware/userGuard");
var _asyncHandler = _interopRequireDefault(require("@global-common/server/routes/helper/asyncHandler"));
var _profileController = require("@diary-server/controller/profile-controller");
var _utils = require("@global-common/server/routes/helper/utils");
var _validator = require("@global-common/utils/validator");
var _user = require("@global-common/db/model/user");
var _uploadUser = require("@diary-server/routes/middleware/upload-user");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function profileRoutes(router = (0, _express.Router)()) {
  // 프로필 조회
  router.get('/diary/profile', _userGuard.diaryGuard, (0, _asyncHandler.default)(getProfile));
  // 프로필 수정
  router.put('/diary/profile/edit', _userGuard.diaryGuard, (0, _asyncHandler.default)(putProfile));
  // 프로필 아바타 수정
  router.put('/diary/profile/avatar', _userGuard.diaryGuard, (0, _uploadUser.userUpload)('avatar').single('avatar'), (0, _asyncHandler.default)(putAvatar));
  async function getProfile(req, res) {
    const result = await (0, _profileController.userProfile)(req.user.id);
    res.json(result);
  }
  async function putProfile(req, res) {
    const body = (0, _validator.validateInputData)(req.body, {
      name: _joi.default.string(),
      gender: _joi.default.string().valid(..._lodash.default.values(_user.UserGender)),
      birthDate: _joi.default.date()
    });
    await (0, _profileController.updateProfile)(body, req.user.id);
    (0, _utils.sendOk)(res);
  }
  async function putAvatar(req, res) {
    await (0, _profileController.saveUserAvatar)(req.user.id, req.file);
    (0, _utils.sendOk)(res);
  }
  return router;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwcm9maWxlUm91dGVzIiwicm91dGVyIiwiUm91dGVyIiwiZ2V0IiwiZGlhcnlHdWFyZCIsImFzeW5jSGFuZGxlciIsImdldFByb2ZpbGUiLCJwdXQiLCJwdXRQcm9maWxlIiwidXNlclVwbG9hZCIsInNpbmdsZSIsInB1dEF2YXRhciIsInJlcSIsInJlcyIsInJlc3VsdCIsInVzZXJQcm9maWxlIiwidXNlciIsImlkIiwianNvbiIsImJvZHkiLCJ2YWxpZGF0ZUlucHV0RGF0YSIsIm5hbWUiLCJKb2kiLCJzdHJpbmciLCJnZW5kZXIiLCJ2YWxpZCIsIl8iLCJ2YWx1ZXMiLCJVc2VyR2VuZGVyIiwiYmlydGhEYXRlIiwiZGF0ZSIsInVwZGF0ZVByb2ZpbGUiLCJzZW5kT2siLCJzYXZlVXNlckF2YXRhciIsImZpbGUiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZGlhcnktc2VydmVyL3JvdXRlcy9kZWZhdWx0LWxvYWQvcHJvZmlsZS1yb3V0ZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnZXhwcmVzcydcclxuaW1wb3J0IEpvaSBmcm9tICdqb2knXHJcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCdcclxuXHJcbmltcG9ydCB7IGRpYXJ5R3VhcmQgfSBmcm9tICdAZGlhcnktc2VydmVyL3JvdXRlcy9taWRkbGV3YXJlL3VzZXJHdWFyZCdcclxuaW1wb3J0IGFzeW5jSGFuZGxlciBmcm9tICdAZ2xvYmFsLWNvbW1vbi9zZXJ2ZXIvcm91dGVzL2hlbHBlci9hc3luY0hhbmRsZXInXHJcbmltcG9ydCB7IHNhdmVVc2VyQXZhdGFyLCB1cGRhdGVQcm9maWxlLCB1c2VyUHJvZmlsZSB9IGZyb20gJ0BkaWFyeS1zZXJ2ZXIvY29udHJvbGxlci9wcm9maWxlLWNvbnRyb2xsZXInXHJcbmltcG9ydCB7IHNlbmRPayB9IGZyb20gJ0BnbG9iYWwtY29tbW9uL3NlcnZlci9yb3V0ZXMvaGVscGVyL3V0aWxzJ1xyXG5pbXBvcnQgeyB2YWxpZGF0ZUlucHV0RGF0YSB9IGZyb20gJ0BnbG9iYWwtY29tbW9uL3V0aWxzL3ZhbGlkYXRvcidcclxuaW1wb3J0IHsgVXNlckdlbmRlciB9IGZyb20gJ0BnbG9iYWwtY29tbW9uL2RiL21vZGVsL3VzZXInXHJcbmltcG9ydCB7IHVzZXJVcGxvYWQgfSBmcm9tICdAZGlhcnktc2VydmVyL3JvdXRlcy9taWRkbGV3YXJlL3VwbG9hZC11c2VyJ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcHJvZmlsZVJvdXRlcyAocm91dGVyID0gUm91dGVyKCkpIHtcclxuICAvLyDtlITroZztlYQg7KGw7ZqMXHJcbiAgcm91dGVyLmdldCgnL2RpYXJ5L3Byb2ZpbGUnLCBkaWFyeUd1YXJkLCBhc3luY0hhbmRsZXIoZ2V0UHJvZmlsZSkpXHJcbiAgLy8g7ZSE66Gc7ZWEIOyImOyglVxyXG4gIHJvdXRlci5wdXQoJy9kaWFyeS9wcm9maWxlL2VkaXQnLCBkaWFyeUd1YXJkLCBhc3luY0hhbmRsZXIocHV0UHJvZmlsZSkpXHJcbiAgLy8g7ZSE66Gc7ZWEIOyVhOuwlO2DgCDsiJjsoJVcclxuICByb3V0ZXIucHV0KCcvZGlhcnkvcHJvZmlsZS9hdmF0YXInLCBkaWFyeUd1YXJkLCB1c2VyVXBsb2FkKCdhdmF0YXInKS5zaW5nbGUoJ2F2YXRhcicpLCBhc3luY0hhbmRsZXIocHV0QXZhdGFyKSlcclxuXHJcbiAgYXN5bmMgZnVuY3Rpb24gZ2V0UHJvZmlsZSAocmVxLCByZXMpIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJQcm9maWxlKHJlcS51c2VyLmlkKVxyXG5cclxuICAgIHJlcy5qc29uKHJlc3VsdClcclxuICB9XHJcblxyXG4gIGFzeW5jIGZ1bmN0aW9uIHB1dFByb2ZpbGUgKHJlcSwgcmVzKSB7XHJcbiAgICBjb25zdCBib2R5ID0gdmFsaWRhdGVJbnB1dERhdGEocmVxLmJvZHksIHtcclxuICAgICAgbmFtZTogSm9pLnN0cmluZygpLFxyXG4gICAgICBnZW5kZXI6IEpvaS5zdHJpbmcoKS52YWxpZCguLi5fLnZhbHVlcyhVc2VyR2VuZGVyKSksXHJcbiAgICAgIGJpcnRoRGF0ZTogSm9pLmRhdGUoKSxcclxuICAgIH0pXHJcbiAgICBhd2FpdCB1cGRhdGVQcm9maWxlKGJvZHksIHJlcS51c2VyLmlkKVxyXG5cclxuICAgIHNlbmRPayhyZXMpXHJcbiAgfVxyXG5cclxuICBhc3luYyBmdW5jdGlvbiBwdXRBdmF0YXIgKHJlcSwgcmVzKSB7XHJcbiAgICBhd2FpdCBzYXZlVXNlckF2YXRhcihyZXEudXNlci5pZCwgcmVxLmZpbGUpXHJcblxyXG4gICAgc2VuZE9rKHJlcylcclxuICB9XHJcblxyXG4gIHJldHVybiByb3V0ZXJcclxufVxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQXdFO0FBRXpELFNBQVNBLGFBQWEsQ0FBRUMsTUFBTSxHQUFHLElBQUFDLGVBQU0sR0FBRSxFQUFFO0VBQ3hEO0VBQ0FELE1BQU0sQ0FBQ0UsR0FBRyxDQUFDLGdCQUFnQixFQUFFQyxxQkFBVSxFQUFFLElBQUFDLHFCQUFZLEVBQUNDLFVBQVUsQ0FBQyxDQUFDO0VBQ2xFO0VBQ0FMLE1BQU0sQ0FBQ00sR0FBRyxDQUFDLHFCQUFxQixFQUFFSCxxQkFBVSxFQUFFLElBQUFDLHFCQUFZLEVBQUNHLFVBQVUsQ0FBQyxDQUFDO0VBQ3ZFO0VBQ0FQLE1BQU0sQ0FBQ00sR0FBRyxDQUFDLHVCQUF1QixFQUFFSCxxQkFBVSxFQUFFLElBQUFLLHNCQUFVLEVBQUMsUUFBUSxDQUFDLENBQUNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFBTCxxQkFBWSxFQUFDTSxTQUFTLENBQUMsQ0FBQztFQUUvRyxlQUFlTCxVQUFVLENBQUVNLEdBQUcsRUFBRUMsR0FBRyxFQUFFO0lBQ25DLE1BQU1DLE1BQU0sR0FBRyxNQUFNLElBQUFDLDhCQUFXLEVBQUNILEdBQUcsQ0FBQ0ksSUFBSSxDQUFDQyxFQUFFLENBQUM7SUFFN0NKLEdBQUcsQ0FBQ0ssSUFBSSxDQUFDSixNQUFNLENBQUM7RUFDbEI7RUFFQSxlQUFlTixVQUFVLENBQUVJLEdBQUcsRUFBRUMsR0FBRyxFQUFFO0lBQ25DLE1BQU1NLElBQUksR0FBRyxJQUFBQyw0QkFBaUIsRUFBQ1IsR0FBRyxDQUFDTyxJQUFJLEVBQUU7TUFDdkNFLElBQUksRUFBRUMsWUFBRyxDQUFDQyxNQUFNLEVBQUU7TUFDbEJDLE1BQU0sRUFBRUYsWUFBRyxDQUFDQyxNQUFNLEVBQUUsQ0FBQ0UsS0FBSyxDQUFDLEdBQUdDLGVBQUMsQ0FBQ0MsTUFBTSxDQUFDQyxnQkFBVSxDQUFDLENBQUM7TUFDbkRDLFNBQVMsRUFBRVAsWUFBRyxDQUFDUSxJQUFJO0lBQ3JCLENBQUMsQ0FBQztJQUNGLE1BQU0sSUFBQUMsZ0NBQWEsRUFBQ1osSUFBSSxFQUFFUCxHQUFHLENBQUNJLElBQUksQ0FBQ0MsRUFBRSxDQUFDO0lBRXRDLElBQUFlLGFBQU0sRUFBQ25CLEdBQUcsQ0FBQztFQUNiO0VBRUEsZUFBZUYsU0FBUyxDQUFFQyxHQUFHLEVBQUVDLEdBQUcsRUFBRTtJQUNsQyxNQUFNLElBQUFvQixpQ0FBYyxFQUFDckIsR0FBRyxDQUFDSSxJQUFJLENBQUNDLEVBQUUsRUFBRUwsR0FBRyxDQUFDc0IsSUFBSSxDQUFDO0lBRTNDLElBQUFGLGFBQU0sRUFBQ25CLEdBQUcsQ0FBQztFQUNiO0VBRUEsT0FBT1osTUFBTTtBQUNmIn0=